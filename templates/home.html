{% extends "base.html" %}
{% load static %}
{% load mathfilters %}
{% load humanize %}

{% block content %}
<div class="container">

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success alert-dismissible fade show auto-dismiss" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <div class="text-center mb-5">
    <img src="{% static 'images/logo.png' %}" alt="Foodie Logo" class="img-responsive logo mb-5 mt-5">
    <form method="POST" class="mb-4">
      {% csrf_token %}
      <div class="input-group input-group-lg justify-content-center mb-5" style="max-width: 1000px; margin: 0 auto;">
        <input type="text" name="query" class="form-control inputstyle" placeholder="Search for calories in your food..." required>
        <button class="btn whoop" type="submit">Find calories</button>
      </div>
    </form>
  </div>

  {% if error %}
    <div class="alert alert-warning text-center">
      {{ error }}
      {% if no_result_query %}
        <a href="{% url 'add_custom_food' %}?name={{ no_result_query }}" class="btn btn-soft">
          ‚ûï Add it manually
        </a>
      {% endif %}
    </div>
  {% endif %}

  {% if api %}
    <div class="text-center mb-4">
      <h1>{{ api.0.name|capfirst }} has a total of <strong>{{ api.0.calories }} Calories</strong>
        {% if api.0.calories > 300 %}
          <img src="{% static 'images/shocked.png' %}" class="img-responsive" alt="Shocked emoji">
        {% endif %}
      </h1>
    </div>
  {% endif %}

  {% if custom_food %}
    <div class="caloriescont shadow rounded">
      <h3 class="heading-md">{{ custom_food.name|capfirst }} (üìù Custom Entry)</h3>
      <ul class="list-group text-start mt-3 mb-4">
        <li class="list-group-item">Calories: {{ custom_food.calories|floatformat:1 }}</li>
        <li class="list-group-item">Protein: {{ custom_food.protein|floatformat:1 }} g</li>
        <li class="list-group-item">Carbs: {{ custom_food.carbohydrates|floatformat:1 }} g</li>
        <li class="list-group-item">Fat: {{ custom_food.fat|floatformat:1 }} g</li>
        <li class="list-group-item">Fiber: {{ custom_food.fiber|floatformat:1 }} g</li>
      </ul>
    </div>
  {% endif %}

  {% if user.is_authenticated %}
    {% if api or custom_food %}
    <form method="POST" class="text-center mt-3">
      {% csrf_token %}
      <div class="input-group justify-content-center" style="max-width: 400px; margin: 0 auto;">
        <input type="number" step="1" name="portion" class="form-control" placeholder="Enter portion in grams" required>
        <button type="submit" class="btn btn-secondary-unified">Add to My Diary</button>
      </div>
    </form>
  {% endif %}
{% endif %}

  {% if api and api.0.sodium_mg > 1000 %}
    <div class="alert alert-danger mt-4">
      ‚ö†Ô∏è This food contains a high amount of sodium. High sodium causes dehydration and water retention.
    </div>
  {% endif %}

  {% if api %}
          <div class="row justify-content-center mt-5 mb-5">
              <div class="col-md-10 caloriescont shadow rounded">
                <div class="row align-items-start">
                  <div class="col-md-6">
                          <h2 class="mt-3 mb-4">Nutritional Values </h2><span></span>
                          <ul class="nutrition-list list-unstyled">
                              <li class="servingsize">Serving Size per 100/Grams <span class="float-end"></span></li>
                              <li>Carbohydrates: <span class="float-end">{{api.0.carbohydrates_total_g}}</span></li>
                              <li>Cholesterol: <span class="float-end">{{api.0.cholesterol_mg}}</span></li>
                              <li>Saturated fat: <span class="float-end">{{api.0.fat_saturated_g}}</span></li>
                              <li>Total Fat: <span class="float-end">{{api.0.fat_saturated_g}}</span></li>
                              <li>Fiber Content: <span class="float-end">{{api.0.fat_total_g}}</span></li>
                              <li>Potassium <span class="float-end">{{api.0.potassium_mg}}</span></li>
                              <li>Protein: <span class="float-end">{{api.0.protein_g}}</span></li>
                              <li>Sodium:<span class="float-end">{{api.0.sodium_mg}}</span></li>
                              <li>Sugar: <span class="float-end">{{api.0.sugar_g}}</span></li>
                          </ul>
                      </div>
                    <div class="col-md-6 mb-5 pt-4">
                      <h4 class="mb-4 fw-semibold text-success">üî• To burn {{ api.0.calories }} calories you will have to</h4>
                      <div class="d-flex align-items-center mb-4">
                        <div class="flex-shrink-0">
                          <img src="{% static 'images/running.png' %}" alt="Jog">
                        </div>
                        <div class="flex-grow-1 ms-3">
                          <h5>Jog</h5>
                          <p>you will have to jog for <strong>{{ api.0.calories|div:378|mul:60|floatformat:0 }}</strong> Minutes</p>
                        </div>
                      </div>
                    
                      <div class="d-flex align-items-center mb-4">
                        <div class="flex-shrink-0">
                          <img src="{% static 'images/yoga.png' %}" alt="Yoga">
                        </div>
                        <div class="flex-grow-1 ms-4">
                          <h5>Do Power Yoga</h5>
                          <p>you will have to Power Yoga for <strong>{{ api.0.calories|div:223|mul:60|floatformat:0 }}</strong> Minutes</p>
                        </div>
                      </div>
                    
                      <div class="d-flex align-items-center mb-4">
                        <div class="flex-shrink-0">
                          <img src="{% static 'images/weightlifter.png' %}" alt="Gym">
                        </div>
                        <div class="flex-grow-1 ms-4">
                          <h5>Get a Gym Workout</h5>
                          <p>you will have to lift weight for <strong>{{ api.0.calories|div:483|mul:60|floatformat:0 }}</strong> Minutes</p>
                        </div>
                      </div>
                    
                      <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                          <img src="{% static 'images/walking.png' %}" alt="Walk">
                        </div>
                        <div class="flex-grow-1 ms-3">
                          <h5>Go for a Brisk Walk</h5>
                          <p>you will have to brisk walk for <strong>{{ api.0.calories|div:294|mul:60|floatformat:0 }}</strong> Minutes</p>
                        </div>
                      </div>
                    </div>

                      <div>
                        <canvas id="myChart" width="400" height="400"></canvas>
                        </div>
                  </div>
              </div>
              {%endif%}
          </div>

         <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js" integrity="sha512-sW/w8s4RWTdFFSduOTGtk4isV1+190E/GghVffMA9XczdJ2MDzSzLEubKAs5h0wzgSJOQTRYyaz73L3d6RtJSg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
          <script>
            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['carbohydrates', 'Cholesterol', 'Saturated fat', 'Total Fat', 'Fiber Content', 'Potassium', 'Protein','Sodium','Sugar'],
                    datasets: [{
                        label: 'Nutritional values of {{api.0.name | capfirst}}',
                        data: [
                              {{api.0.carbohydrates_total_g}},
                              {{api.0.cholesterol_mg}},
                              {{api.0.fat_saturated_g}},
                              {{api.0.fat_saturated_g}},
                              {{api.0.fat_total_g}},
                              {{api.0.potassium_mg}},
                              {{api.0.protein_g}},
                              {{api.0.sodium_mg}},
                              {{api.0.sugar_g}},
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive:true,
                    maintainAspectRatio:false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            </script>
{% endblock %}
